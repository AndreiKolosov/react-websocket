# <a id="top" />Сервер

### Оглавление

- [Описание](#description)
- [Ссылки](#references)

---

## <a id="description" />Описание и особенности
  Вебсокет демо. Серверная часть - Node.js, Express, TypeScript. 
  Базовый функционал был взят из этого [→ туториала ←](https://blog.logrocket.com/websocket-tutorial-real-time-node-react/). Произведен рефакторинг, доработка и расширение функционала.

  - Добавлен Typescript.
  - Добавлен Express.
  - Разделение на API & Websocket. Заложен базовый функционал API. Создан один роут с цитатами.
  - По дефолту, сокет работает на порту ``5000``, API на порту ``4000``. Порты можно поменять в файле ``.env`` (смотри ``.env.example``).
  - Обработка событий сокетного соединения вынесена в отдельный файл ``routes/websocket/index.ts``.
  - Сообщения от клиента разделены на два типа: 
    * Пользовательские - создание имени, сообщение в чате, коннект\дисконект.
    * Изменения контента в редакторе.

  В момент создания соединения, оно записывается в переменную ``clients`` под сгенерированным ключем ``userId``.  Далее, сервер начинает слушать два события, сообщения от клиента и закрытие соединения. На событие ``message``, сообщение от клиента передается в обработчик, в котором, в зависимости от типа, происходят необходимые манипуляции с данными и сборка ответа. Далее, ответ передается в функцию рассылки, которая проходится по всем открытым соединениям и рассылает актуальные данные на клиент.
  Обработчик дисконекта работает аналогично. При потере соединения, из объекта активных соединений удаляется потерянное соединение и далее, собирается ответ и отдается в фукцию рассылки.

### Технологии
- Node.js
- ws (websocket server)
- Express.js

[Наверх](#top)

---

## <a id="references" />Ссылки

### [- Главный Readme](../README.md)


[Наверх](#top)